;=====================================
; Dialplan Configuration
;=====================================

[general]
static=yes
writeprotect=no
clearglobalvars=no

;=====================================
; Internal Context (WebRTC Users)
;=====================================

[from-internal]
; Echo Test
exten => 600,1,NoOp(Echo Test)
 same => n,Answer()
 same => n,Wait(1)
 same => n,Playback(demo-echotest)
 same => n,Echo()
 same => n,Hangup()

; Music on Hold Test
exten => 601,1,NoOp(Music on Hold Test)
 same => n,Answer()
 same => n,MusicOnHold()

; Conference Room
exten => 700,1,NoOp(Conference Room)
 same => n,Answer()
 same => n,ConfBridge(1)
 same => n,Hangup()

; Voicemail
exten => *97,1,NoOp(Check Voicemail)
 same => n,VoiceMailMain(${CALLERID(num)}@default)
 same => n,Hangup()

; Internal Extensions (1000-1999)
exten => _1XXX,1,NoOp(Call to internal extension ${EXTEN})
 same => n,Set(CALLERID(name)=${CALLERID(name)})
 same => n,Dial(PJSIP/${EXTEN},30)
 same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
 same => n(unavail),VoiceMail(${EXTEN}@default,u)
 same => n,Hangup()
 same => n(busy),VoiceMail(${EXTEN}@default,b)
 same => n,Hangup()

; External calls via Genesys (10 digit numbers)
exten => _NXXXXXXXXX,1,NoOp(External call to ${EXTEN} via Genesys)
 same => n,Set(CALLERID(num)=${CALLERID(num)})
 same => n,Dial(PJSIP/${EXTEN}@genesys_trunk,60)
 same => n,Hangup()

; International calls via Genesys (011 + country code)
exten => _011.,1,NoOp(International call to ${EXTEN} via Genesys)
 same => n,Dial(PJSIP/${EXTEN}@genesys_trunk,60)
 same => n,Hangup()

; Emergency calls
exten => 911,1,NoOp(Emergency Call)
 same => n,Dial(PJSIP/911@genesys_trunk)
 same => n,Hangup()

;=====================================
; Genesys Inbound Context
;=====================================

[from-genesys]
; Route incoming calls from Genesys to appropriate extension or IVR
exten => _X.,1,NoOp(Incoming call from Genesys: ${CALLERID(all)} to ${EXTEN})
 same => n,Set(CALLERID(name)=${CALLERID(name)})
 same => n,Answer()
 same => n,Wait(1)
 
 ; Route to specific extension if DID matches
 same => n,GotoIf($["${EXTEN}" = "YOUR_DID_1"]?ext1000)
 same => n,GotoIf($["${EXTEN}" = "YOUR_DID_2"]?ext1001)
 
 ; Default IVR
 same => n,Goto(ivr,s,1)
 
 same => n(ext1000),Dial(PJSIP/1000,30)
 same => n,VoiceMail(1000@default,u)
 same => n,Hangup()
 
 same => n(ext1001),Dial(PJSIP/1001,30)
 same => n,VoiceMail(1001@default,u)
 same => n,Hangup()

;=====================================
; IVR Menu
;=====================================

[ivr]
exten => s,1,NoOp(Main IVR)
 same => n,Answer()
 same => n,Wait(1)
 same => n(menu),Background(custom/welcome)
 same => n,Background(custom/press-1-for-sales)
 same => n,Background(custom/press-2-for-support)
 same => n,Background(custom/press-0-for-operator)
 same => n,WaitExten(10)
 same => n,Goto(timeout)

exten => 1,1,NoOp(Sales Department)
 same => n,Dial(PJSIP/1000,30)
 same => n,VoiceMail(1000@default,u)
 same => n,Hangup()

exten => 2,1,NoOp(Support Department)
 same => n,Dial(PJSIP/1001,30)
 same => n,VoiceMail(1001@default,u)
 same => n,Hangup()

exten => 0,1,NoOp(Operator)
 same => n,Dial(PJSIP/1002,30)
 same => n,VoiceMail(1002@default,u)
 same => n,Hangup()

exten => t,1,NoOp(Timeout)
 same => n(timeout),Playback(custom/goodbye)
 same => n,Hangup()

exten => i,1,NoOp(Invalid Input)
 same => n,Playback(invalid)
 same => n,Goto(s,menu)

;=====================================
; Kamailio Context
;=====================================

[from-kamailio]
; Route calls from Kamailio proxy
exten => _X.,1,NoOp(Call from Kamailio to ${EXTEN})
 same => n,Goto(from-internal,${EXTEN},1)




