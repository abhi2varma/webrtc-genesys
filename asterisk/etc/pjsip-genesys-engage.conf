;=====================================
; Genesys Engage On-Premise SIP Configuration
;=====================================

[genesys_engage_trunk]
type=endpoint
context=from-genesys-engage
transport=transport-udp
aors=genesys_engage_trunk
outbound_auth=genesys_engage_auth
disallow=all
allow=ulaw,alaw,g722,g729      ; Common codecs for Genesys Engage
from_user=${GENESYS_USERNAME}  ; Or your Access Code
force_rport=yes
direct_media=no                ; Keep media flowing through Asterisk
ice_support=no
dtmf_mode=rfc4733              ; Or inband if Genesys requires
rtp_symmetric=yes
rewrite_contact=yes
send_rpid=yes
send_pai=yes
trust_id_inbound=yes
trust_id_outbound=yes

; Codec negotiation
rtp_keepalive=30
timers=no

; NAT handling
nat=yes

[genesys_engage_trunk]
type=aor
contact=sip:${GENESYS_SIP_HOST}:${GENESYS_SIP_PORT}
qualify_frequency=60
qualify_timeout=3

[genesys_engage_auth]
type=auth
auth_type=userpass
username=${GENESYS_USERNAME}    ; Your SIP username or Access Code
password=${GENESYS_PASSWORD}    ; Your SIP password
realm=${GENESYS_SIP_HOST}       ; Genesys SIP Server domain

[genesys-engage-identify]
type=identify
endpoint=genesys_engage_trunk
match=${GENESYS_SIP_HOST}       ; Genesys SIP Server IP

;=====================================
; Alternative: IP-Based Authentication
; If Genesys Engage uses IP auth instead of credentials
;=====================================

; Uncomment if using IP-based auth (no username/password)
;[genesys_engage_trunk_ip]
;type=endpoint
;context=from-genesys-engage
;transport=transport-udp
;aors=genesys_engage_trunk
;disallow=all
;allow=ulaw,alaw,g722
;direct_media=no
;rtp_symmetric=yes
;from_user=asterisk
;
;[genesys-engage-identify-ip]
;type=identify
;endpoint=genesys_engage_trunk_ip
;match=YOUR_GENESYS_SIP_SERVER_IP

;=====================================
; Genesys Engage Inbound Context
;=====================================

[from-genesys-engage]
; Incoming calls from Genesys Engage
; These may come with specific ANI/DNIS from Genesys routing

exten => _X.,1,NoOp(Incoming from Genesys Engage)
 same => n,Set(CALLERID(name)=${CALLERID(name)})
 same => n,Set(CALLERID(num)=${CALLERID(num)})
 same => n,Answer()
 same => n,Wait(1)
 
 ; Log Genesys call details
 same => n,Log(NOTICE,Genesys Call: ANI=${CALLERID(num)} DNIS=${EXTEN})
 
 ; Route based on DNIS (Dialed Number)
 ; Update these with your actual route points/DNs
 same => n,GotoIf($["${EXTEN}" = "5000"]?agent_queue)
 same => n,GotoIf($["${EXTEN}" = "5001"]?ivr_menu)
 same => n,GotoIf($["${EXTEN:0:1}" = "1"]?direct_extension)
 
 ; Default to IVR
 same => n,Goto(ivr,s,1)
 
 same => n(agent_queue),NoOp(Route to Agent Queue)
 same => n,Queue(agents,tT)
 same => n,Hangup()
 
 same => n(ivr_menu),NoOp(Route to IVR)
 same => n,Goto(ivr,s,1)
 
 same => n(direct_extension),NoOp(Route to Extension ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN},30)
 same => n,Hangup()

;=====================================
; Outbound to Genesys Engage
;=====================================

[from-internal]
; Outbound calls through Genesys Engage

; External calls (9 + number)
exten => _9NXXXXXXXXX,1,NoOp(External call via Genesys: ${EXTEN:1})
 same => n,Set(CALLERID(num)=${CALLERID(num)})
 same => n,Dial(PJSIP/${EXTEN:1}@genesys_engage_trunk,60)
 same => n,Hangup()

; Direct Genesys Route Point access
exten => _5XXX,1,NoOp(Genesys Route Point: ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN}@genesys_engage_trunk,60)
 same => n,Hangup()

;=====================================
; Notes for Genesys Engage Integration
;=====================================

; 1. SIP Server: Use your Genesys SIP Server IP (not cloud endpoint)
; 2. Port: Usually 5060 (UDP) or 5061 (TCP/TLS)
; 3. Authentication: May be IP-based or username/password
; 4. Route Points: Configure DNs in Genesys Configuration Manager
; 5. T-Server Integration: For screen pops, may need CTI connector
; 6. Codec: Typically G.711 (ulaw/alaw) or G.729
; 7. DTMF: RFC2833 is standard, but check Genesys config
; 8. Call Variables: Genesys may send custom SIP headers




