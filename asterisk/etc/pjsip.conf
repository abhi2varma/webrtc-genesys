;=====================================
; Asterisk as SIP Gateway for Genesys SIP Endpoints
; Genesys Workspace Web Edition controls all calls
;=====================================

[global]
type=global
max_forwards=70
keep_alive_interval=90
user_agent=Asterisk-WebRTC-Client

;=====================================
; Transport Configurations
;=====================================

; WebSocket for WebRTC Clients (non-secure)
[transport-ws]
type=transport
protocol=ws
bind=0.0.0.0:8088
external_media_address=103.167.180.166
external_signaling_address=103.167.180.166
local_net=172.17.0.0/16,10.0.0.0/8

; WebSocket Secure for WebRTC Clients
[transport-wss]
type=transport
protocol=wss
bind=0.0.0.0:8089
cert_file=/etc/certs/cert.pem
priv_key_file=/etc/certs/key.pem
ca_list_file=/etc/certs/ca.pem
allow_reload=yes
external_media_address=103.167.180.166
external_signaling_address=103.167.180.166
local_net=172.17.0.0/16,10.0.0.0/8

; UDP Transport for Genesys SIP Server (Internal)
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
external_media_address=192.168.210.54
external_signaling_address=192.168.210.54

;=====================================
; Genesys SIP Server Connection
;=====================================

[genesys_sip_server]
type=endpoint
context=from-genesys
transport=transport-udp
aors=genesys_sip_server
outbound_auth=genesys_auth
disallow=all
allow=ulaw,alaw,g722,opus
from_user=asterisk-client
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
send_rpid=yes
send_pai=yes
trust_id_inbound=yes
trust_id_outbound=yes
dtmf_mode=rfc4733

[genesys_sip_server]
type=aor
contact=sip:192.168.210.81:5060
qualify_frequency=60

[genesys_auth]
type=auth
auth_type=userpass
; IP-based auth - no credentials needed
username=asterisk
password=asterisk

[genesys-identify]
type=identify
endpoint=genesys_sip_server
match=192.168.210.81

;=====================================
; Genesys Outbound Registrations (for each DN)
;=====================================
; These allow dynamic registration via AMI PJSIPRegister command
; Registration monitor uses these to register/unregister DNs

[genesys_reg_5001]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5001@192.168.210.81
contact_user=5001
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5002]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5002@192.168.210.81
contact_user=5002
; Use explicit transport and Asterisk's IP to help T-Server recognize the endpoint
endpoint=5002
line=yes
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5003]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5003@192.168.210.81
contact_user=5003
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5004]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5004@192.168.210.81
contact_user=5004
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5005]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5005@192.168.210.81
contact_user=5005
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5006]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5006@192.168.210.81
contact_user=5006
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5007]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5007@192.168.210.81
contact_user=5007
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5008]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5008@192.168.210.81
contact_user=5008
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5009]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5009@192.168.210.81
contact_user=5009
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5010]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5010@192.168.210.81
contact_user=5010
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5011]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5011@192.168.210.81
contact_user=5011
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5012]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5012@192.168.210.81
contact_user=5012
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5013]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5013@192.168.210.81
contact_user=5013
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5014]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5014@192.168.210.81
contact_user=5014
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5015]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5015@192.168.210.81
contact_user=5015
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5016]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5016@192.168.210.81
contact_user=5016
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5017]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5017@192.168.210.81
contact_user=5017
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5018]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5018@192.168.210.81
contact_user=5018
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5019]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5019@192.168.210.81
contact_user=5019
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_5020]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:5020@192.168.210.81
contact_user=5020
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

;=====================================
; Agent DN Template (WebRTC Endpoints)
;=====================================

[agent_dn](!)
type=endpoint
transport=transport-ws
context=genesys-agent
disallow=all
allow=ulaw,alaw
webrtc=yes
ice_support=yes
use_avpf=yes
media_encryption=dtls
dtls_verify=fingerprint
dtls_rekey=0
dtls_cert_file=/etc/certs/cert.pem
dtls_private_key=/etc/certs/key.pem
dtls_ca_file=/etc/certs/ca.pem
dtls_setup=actpass
rtcp_mux=yes
use_ptime=yes
force_rport=yes
rewrite_contact=yes
direct_media=no
rtp_timeout=60
rtp_timeout_hold=300
rtp_symmetric=yes
;Force external media address for WebRTC endpoints
media_address=103.167.180.166
media_use_received_transport=yes

; Calls routed via dialplan (no outbound_proxy)
; See extensions-sip-endpoint.conf [genesys-agent] context

[agent_dn_auth](!)
type=auth
auth_type=userpass

[agent_dn_aor](!)
type=aor
max_contacts=1
remove_existing=yes
qualify_frequency=30
support_path=yes

;=====================================
; Agent DNs (5001-5020)
; Add more as needed
;=====================================

; Agent 5001
[5001](agent_dn)
auth=5001
aors=5001
callerid="Agent 5001" <5001>

[5001](agent_dn_auth)
password=Genesys2024!WebRTC
username=5001

[5001](agent_dn_aor)

; Agent 5002
[5002](agent_dn)
auth=5002
aors=5002
callerid="Agent 5002" <5002>

[5002](agent_dn_auth)
password=Genesys2024!WebRTC
username=5002

[5002](agent_dn_aor)

; Agent 5003
[5003](agent_dn)
auth=5003
aors=5003
callerid="Agent 5003" <5003>

[5003](agent_dn_auth)
password=Genesys2024!WebRTC
username=5003

[5003](agent_dn_aor)

; Agent 5004
[5004](agent_dn)
auth=5004
aors=5004
callerid="Agent 5004" <5004>

[5004](agent_dn_auth)
password=Genesys2024!WebRTC
username=5004

[5004](agent_dn_aor)

; Agent 5005
[5005](agent_dn)
auth=5005
aors=5005
callerid="Agent 5005" <5005>

[5005](agent_dn_auth)
password=Genesys2024!WebRTC
username=5005

[5005](agent_dn_aor)

; Agent 5006
[5006](agent_dn)
auth=5006
aors=5006
callerid="Agent 5006" <5006>

[5006](agent_dn_auth)
password=Genesys2024!WebRTC
username=5006

[5006](agent_dn_aor)

; Agent 5007
[5007](agent_dn)
auth=5007
aors=5007
callerid="Agent 5007" <5007>

[5007](agent_dn_auth)
password=Genesys2024!WebRTC
username=5007

[5007](agent_dn_aor)

; Agent 5008
[5008](agent_dn)
auth=5008
aors=5008
callerid="Agent 5008" <5008>

[5008](agent_dn_auth)
password=Genesys2024!WebRTC
username=5008

[5008](agent_dn_aor)

; Agent 5009
[5009](agent_dn)
auth=5009
aors=5009
callerid="Agent 5009" <5009>

[5009](agent_dn_auth)
password=Genesys2024!WebRTC
username=5009

[5009](agent_dn_aor)

; Agent 5010
[5010](agent_dn)
auth=5010
aors=5010
callerid="Agent 5010" <5010>

[5010](agent_dn_auth)
password=Genesys2024!WebRTC
username=5010

[5010](agent_dn_aor)

; Agent 5011
[5011](agent_dn)
auth=5011
aors=5011
callerid="Agent 5011" <5011>

[5011](agent_dn_auth)
password=Genesys2024!WebRTC
username=5011

[5011](agent_dn_aor)

; Agent 5012
[5012](agent_dn)
auth=5012
aors=5012
callerid="Agent 5012" <5012>

[5012](agent_dn_auth)
password=Genesys2024!WebRTC
username=5012

[5012](agent_dn_aor)

; Agent 5013
[5013](agent_dn)
auth=5013
aors=5013
callerid="Agent 5013" <5013>

[5013](agent_dn_auth)
password=Genesys2024!WebRTC
username=5013

[5013](agent_dn_aor)

; Agent 5014
[5014](agent_dn)
auth=5014
aors=5014
callerid="Agent 5014" <5014>

[5014](agent_dn_auth)
password=Genesys2024!WebRTC
username=5014

[5014](agent_dn_aor)

; Agent 5015
[5015](agent_dn)
auth=5015
aors=5015
callerid="Agent 5015" <5015>

[5015](agent_dn_auth)
password=Genesys2024!WebRTC
username=5015

[5015](agent_dn_aor)

; Agent 5016
[5016](agent_dn)
auth=5016
aors=5016
callerid="Agent 5016" <5016>

[5016](agent_dn_auth)
password=Genesys2024!WebRTC
username=5016

[5016](agent_dn_aor)

; Agent 5017
[5017](agent_dn)
auth=5017
aors=5017
callerid="Agent 5017" <5017>

[5017](agent_dn_auth)
password=Genesys2024!WebRTC
username=5017

[5017](agent_dn_aor)

; Agent 5018
[5018](agent_dn)
auth=5018
aors=5018
callerid="Agent 5018" <5018>

[5018](agent_dn_auth)
password=Genesys2024!WebRTC
username=5018

[5018](agent_dn_aor)

; Agent 5019
[5019](agent_dn)
auth=5019
aors=5019
callerid="Agent 5019" <5019>

[5019](agent_dn_auth)
password=Genesys2024!WebRTC
username=5019

[5019](agent_dn_aor)

; Agent 5020
[5020](agent_dn)
auth=5020
aors=5020
callerid="Agent 5020" <5020>

[5020](agent_dn_auth)
password=Genesys2024!WebRTC
username=5020

[5020](agent_dn_aor)

;=====================================
; To add more agents, copy the pattern above
; Change the DN number and password
;=====================================

;=====================================
; DN Registration to Genesys SIP Server
; DYNAMIC REGISTRATION - Triggered by registration-monitor service

;=====================================
; Genesys SIP Server Registrations
; REMOVED: Static registrations disabled
; Dynamic registration is now handled by the registration-monitor service
; When a WebRTC client connects, the monitor will dynamically register the DN to Genesys
;=====================================

;=====================================
; Additional Agent DNs for Genesys
;=====================================

; Agent 1003 (for WebRTC Bridge)
[1003](agent_dn)
auth=1003
aors=1003
callerid="Agent 1003" <1003>

[1003](agent_dn_auth)
password=Genesys2024!WebRTC
username=1003

[1003](agent_dn_aor)

; Agent 1002 (for WebRTC Bridge Testing)
[1002](agent_dn)
auth=1002
aors=1002
callerid="Agent 1002" <1002>

[1002](agent_dn_auth)
password=Genesys2024!WebRTC
username=1002

[1002](agent_dn_aor)

[genesys_reg_1002]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:1002@192.168.210.81
contact_user=1002
endpoint=1002
line=yes
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0

[genesys_reg_1003]
type=registration
outbound_auth=genesys_auth
server_uri=sip:192.168.210.81
client_uri=sip:1003@192.168.210.81
contact_user=1003
endpoint=1003
line=yes
retry_interval=0
forbidden_retry_interval=0
expiration=3600
max_retries=0
