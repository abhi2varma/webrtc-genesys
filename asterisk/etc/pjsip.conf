;=====================================
; Asterisk as SIP Gateway for Genesys SIP Endpoints
; Genesys Workspace Web Edition controls all calls
;=====================================

[global]
type=global
max_forwards=70
keep_alive_interval=90
user_agent=Asterisk-Genesys-Gateway

;=====================================
; Transport Configurations
;=====================================

; WebSocket Secure for WebRTC Clients
[transport-wss]
type=transport
protocol=wss
bind=0.0.0.0:8089
cert_file=/etc/certs/cert.pem
priv_key_file=/etc/certs/key.pem
ca_list_file=/etc/certs/ca.pem
allow_reload=yes

; UDP Transport for Genesys SIP Server
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
external_media_address=${PUBLIC_IP}
external_signaling_address=${PUBLIC_IP}

;=====================================
; Genesys SIP Server Connection
;=====================================

[genesys_sip_server]
type=endpoint
context=from-genesys
transport=transport-udp
aors=genesys_sip_server
outbound_auth=genesys_auth
disallow=all
allow=ulaw,alaw,g722,opus
from_user=asterisk-gateway
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
send_rpid=yes
send_pai=yes
trust_id_inbound=yes
trust_id_outbound=yes
dtmf_mode=rfc4733

[genesys_sip_server]
type=aor
contact=sip:${GENESYS_SIP_HOST}:${GENESYS_SIP_PORT}
qualify_frequency=60

[genesys_auth]
type=auth
auth_type=userpass
username=${GENESYS_USERNAME}
password=${GENESYS_PASSWORD}

[genesys-identify]
type=identify
endpoint=genesys_sip_server
match=${GENESYS_SIP_HOST}

;=====================================
; Agent DN Template (WebRTC Endpoints)
;=====================================

[agent_dn](!)
type=endpoint
transport=transport-wss
context=genesys-agent
disallow=all
allow=opus,ulaw,alaw
webrtc=yes
ice_support=yes
use_avpf=yes
media_encryption=dtls
dtls_verify=fingerprint
dtls_rekey=0
dtls_cert_file=/etc/certs/cert.pem
dtls_private_key=/etc/certs/key.pem
dtls_ca_file=/etc/certs/ca.pem
dtls_setup=actpass
rtcp_mux=yes
use_ptime=yes
force_rport=yes
rewrite_contact=yes
direct_media=no
rtp_symmetric=yes
media_use_received_transport=yes

; Forward all calls to Genesys
outbound_proxy=sip:${GENESYS_SIP_HOST}:${GENESYS_SIP_PORT}

[agent_dn_auth](!)
type=auth
auth_type=userpass

[agent_dn_aor](!)
type=aor
max_contacts=1
remove_existing=yes
qualify_frequency=30

;=====================================
; Agent DNs (5001-5020)
; Add more as needed
;=====================================

; Agent 5001
[5001](agent_dn)
auth=5001
aors=5001
callerid="Agent 5001" <5001>

[5001](agent_dn_auth)
password=GenesysAgent5001!
username=5001

[5001](agent_dn_aor)

; Agent 5002
[5002](agent_dn)
auth=5002
aors=5002
callerid="Agent 5002" <5002>

[5002](agent_dn_auth)
password=GenesysAgent5002!
username=5002

[5002](agent_dn_aor)

; Agent 5003
[5003](agent_dn)
auth=5003
aors=5003
callerid="Agent 5003" <5003>

[5003](agent_dn_auth)
password=GenesysAgent5003!
username=5003

[5003](agent_dn_aor)

; Agent 5004
[5004](agent_dn)
auth=5004
aors=5004
callerid="Agent 5004" <5004>

[5004](agent_dn_auth)
password=GenesysAgent5004!
username=5004

[5004](agent_dn_aor)

; Agent 5005
[5005](agent_dn)
auth=5005
aors=5005
callerid="Agent 5005" <5005>

[5005](agent_dn_auth)
password=GenesysAgent5005!
username=5005

[5005](agent_dn_aor)

; Agent 5006
[5006](agent_dn)
auth=5006
aors=5006
callerid="Agent 5006" <5006>

[5006](agent_dn_auth)
password=GenesysAgent5006!
username=5006

[5006](agent_dn_aor)

; Agent 5007
[5007](agent_dn)
auth=5007
aors=5007
callerid="Agent 5007" <5007>

[5007](agent_dn_auth)
password=GenesysAgent5007!
username=5007

[5007](agent_dn_aor)

; Agent 5008
[5008](agent_dn)
auth=5008
aors=5008
callerid="Agent 5008" <5008>

[5008](agent_dn_auth)
password=GenesysAgent5008!
username=5008

[5008](agent_dn_aor)

; Agent 5009
[5009](agent_dn)
auth=5009
aors=5009
callerid="Agent 5009" <5009>

[5009](agent_dn_auth)
password=GenesysAgent5009!
username=5009

[5009](agent_dn_aor)

; Agent 5010
[5010](agent_dn)
auth=5010
aors=5010
callerid="Agent 5010" <5010>

[5010](agent_dn_auth)
password=GenesysAgent5010!
username=5010

[5010](agent_dn_aor)

; Agent 5011
[5011](agent_dn)
auth=5011
aors=5011
callerid="Agent 5011" <5011>

[5011](agent_dn_auth)
password=GenesysAgent5011!
username=5011

[5011](agent_dn_aor)

; Agent 5012
[5012](agent_dn)
auth=5012
aors=5012
callerid="Agent 5012" <5012>

[5012](agent_dn_auth)
password=GenesysAgent5012!
username=5012

[5012](agent_dn_aor)

; Agent 5013
[5013](agent_dn)
auth=5013
aors=5013
callerid="Agent 5013" <5013>

[5013](agent_dn_auth)
password=GenesysAgent5013!
username=5013

[5013](agent_dn_aor)

; Agent 5014
[5014](agent_dn)
auth=5014
aors=5014
callerid="Agent 5014" <5014>

[5014](agent_dn_auth)
password=GenesysAgent5014!
username=5014

[5014](agent_dn_aor)

; Agent 5015
[5015](agent_dn)
auth=5015
aors=5015
callerid="Agent 5015" <5015>

[5015](agent_dn_auth)
password=GenesysAgent5015!
username=5015

[5015](agent_dn_aor)

; Agent 5016
[5016](agent_dn)
auth=5016
aors=5016
callerid="Agent 5016" <5016>

[5016](agent_dn_auth)
password=GenesysAgent5016!
username=5016

[5016](agent_dn_aor)

; Agent 5017
[5017](agent_dn)
auth=5017
aors=5017
callerid="Agent 5017" <5017>

[5017](agent_dn_auth)
password=GenesysAgent5017!
username=5017

[5017](agent_dn_aor)

; Agent 5018
[5018](agent_dn)
auth=5018
aors=5018
callerid="Agent 5018" <5018>

[5018](agent_dn_auth)
password=GenesysAgent5018!
username=5018

[5018](agent_dn_aor)

; Agent 5019
[5019](agent_dn)
auth=5019
aors=5019
callerid="Agent 5019" <5019>

[5019](agent_dn_auth)
password=GenesysAgent5019!
username=5019

[5019](agent_dn_aor)

; Agent 5020
[5020](agent_dn)
auth=5020
aors=5020
callerid="Agent 5020" <5020>

[5020](agent_dn_auth)
password=GenesysAgent5020!
username=5020

[5020](agent_dn_aor)

;=====================================
; To add more agents, copy the pattern above
; Change the DN number and password
;=====================================

;=====================================
; Registration Proxy Configuration
; Forwards agent registrations to Genesys
;=====================================

[registration]
type=registration
transport=transport-udp
outbound_proxy=sip:${GENESYS_SIP_HOST}:${GENESYS_SIP_PORT}
server_uri=sip:${GENESYS_SIP_HOST}
client_uri=sip:asterisk-gateway@${GENESYS_SIP_HOST}
outbound_auth=genesys_auth
retry_interval=60
